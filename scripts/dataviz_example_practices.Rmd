---
title: "starting_codes"
author: "Mahmudur Rahman"
date: "03/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,fig.width=8, fig.height=5)# setting the default size of the  plots within the r markdown
```
 
 Work through the code examples from the book [https://socviz.co/index.html#preface]
 
 ## Load libraries 
```{r}
my_packages <- c("tidyverse", "broom", "coefplot", "cowplot",
                 "gapminder", "GGally", "ggrepel", "ggridges", "gridExtra",
                 "here", "interplot", "margins", "maps", "mapproj",
                 "mapdata", "MASS", "quantreg", "rlang", "scales",
                 "survey", "srvyr", "viridis", "viridisLite", "devtools")

# install.packages(my_packages, repos = "http://cran.rstudio.com")
library(tidyverse)
library(hrbrthemes)
library(ggthemes)
library(scales)
library(srvyr)
library(survey)
library(devtools)
library(socviz)
library(kableExtra)
library(here)

# devtools::install_github("kjhealy/socviz")
```

## Aesthetics can be mapped per geom
Below Color is mapped to continent on geom_point not on the smooth.this could be done on globally too 
```{r example}
gapminder <- gapminder::gapminder

gapminder %>% 
  ggplot(aes(gdpPercap,lifeExp))+
  geom_point(aes(color = continent))+
  geom_smooth(method = "loess")+
  scale_x_log10()


gapminder %>% 
  ggplot(aes(gdpPercap,lifeExp))+
  geom_point(aes(color = log(pop)))+
  geom_smooth(method = "loess")+
  scale_x_log10()

gapminder %>% 
  filter(continent != "Oceania",
         year >1992) %>% 
  ggplot(aes(gdpPercap,lifeExp))+
  geom_point(aes(color = factor(year)))+
  geom_smooth(method = "loess")+
  scale_x_log10()+
  facet_grid(factor(year)~ continent)+
  theme_hc()
  # theme_wsj()+
  # scale_colour_wsj("colors6")
```

# Show the right numbers 
```{r}

# faceting by continents
gapminder %>% 
  filter(continent != "Oceania") %>% 
  ggplot(aes(year, gdpPercap))+
  geom_line(aes(group = country,color = continent))+
  facet_wrap(~ continent,nrow = 1)+
  scale_y_log10(labels = dollar)+
  theme_wsj()+
  scale_color_calc()+
  labs(x = "Year",
       y = "Gdp per cappita",
       title = "Gpd per capita on four continents")

```


Plot customisation 
scale, guide  and theme function to get more ocontrol over the content and appreance of the graphs 

Approach:
We want a table of tidy data, a mapping of variables to aesthetic elements, and a particular type of graph. If you can keep sight of this, it will make it easier to confidently approach the job of getting any particular graph to look just right.
```{r}
glimpse(gss_sm) # data from socviz pkg
gss_sm 


```
Create a table from gss_sm df
```{r}
rel_by_region <- gss_sm %>% 
  group_by(bigregion,religion) %>% 
  summarise(total = n()) %>% 
  mutate(freq = total/sum(total),
         pct = round((freq*100),0))

rel_by_region %>% 
ggplot(aes(bigregion,pct,fill = religion))+
  geom_col(position = "identity") #position = "identity" means “just plot the values as given”.
  
rel_by_region %>% 
ggplot(aes(bigregion,pct,fill = religion ))+
  geom_col(position = "dodge2") + # dodge2 gets spaced bar 
  theme_ipsum()+
  labs(x = "Religion",
       y = "Percent",
       fill = "Religion")+ # Renaming legend title 
  theme(legend.position = "top",legend.title = element_text(face = "bold",size = 12))+
  theme(legend.text = element_text(face = "bold",size = 10))
  
# the plots not is not that good , two crowded, lets imporove on it .
# dodge charts can be clearly expressed as factes plots

rel_by_region %>% 
ggplot(aes(religion,pct,fill = religion ))+
  geom_col(position = "dodge2") +
  coord_flip()+
  guides(fill = F)+ # removes legend 
    facet_grid(~ bigregion)+
  labs(x = "Religion",
       y = "Percent",
       fill = "Religion")+
  theme_ipsum()
```


Continuous variables by group or category
```{r}
 # decade’s worth of information on the donation of organs for transplants in seventeen OECD countries.
# data comes from socviz library()

organdata %>% 
  select(1:5) %>% 
  sample_n(size = 10) %>% # looking at 5 columns randomly %>% 

  
organdata %>% 
    ggplot(aes(year,donors))+
    geom_line(aes(group = country))+
    facet_wrap(~ country)+
  theme_ipsum()


```

# Box plot
```{r}
#Boxplots reordered by mean donation rate.
organdata %>% 
  ggplot(aes(fct_reorder(country,donors,na.rm = TRUE),donors, fill = world))+
  geom_boxplot()+
  coord_flip()+
  theme_ipsum()+
  labs(x = NULL)+
  theme(legend.position = "top")
```

Advantage of box plot:
By default the facets are ordered alphabetically by country
Putting categorical variables on the y-axis to compare their distributions is a very useful trick. Its makes it easy to effectively present summary data on more categories. The plots can be quite compact and fit a relatively large number of cases in by row. The approach also has the advantage of putting the variable being compared onto the x-axis, which sometimes makes it easier to compare across categories.

# geom_point
```{r}
# if observation withing each category is too small, then it can be plotted with points,this time color instead of fill.default geom_point() plot shape has a color attribute, but not a fill.

organdata %>% 
  ggplot(aes(fct_reorder(country,donors,na.rm = TRUE),donors, color = world))+
  geom_point()+
  coord_flip()+
  theme_ipsum()+
  labs(x = NULL)+
  theme(legend.position = "top")


ggsave(here::here( "output", "plot_point_not_bx_plot.png"),width = 10, height = 8, dpi = 150, units = "in", device='png')

```

# geom_jitter

When there is over plotting of observationsin values and in order to get a better sense of how many observations there are at different values we can use geom_jitter

```{r}
organdata %>% 
  ggplot(aes(fct_reorder(country,donors,na.rm = TRUE),donors, color = world))+
  geom_jitter()+
  coord_flip()+
  theme_ipsum()+
  labs(x = NULL)+
  theme(legend.position = "top")

ggsave(here::here( "output", "geom_jitter.png"),width = 4, height = 4, dpi = 150, units = "in", device='png')
dev.off()

# dev.off() after all the plotting, to save the file and return control to the screen.
# execute this code after creating the plot to finish creating the image file
```








